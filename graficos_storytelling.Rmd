---
title: "Untitled"
author: "Fernando Almeida Barbalho"
date: '2024-01-23'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

library(tidyverse)
library(colorspace)
library(viridis)

dados_orcamento_2023 <- readRDS("~/Github/orcamento_ministerios/dados_orcamento_2023.rds")
df_de_para <- readRDS("~/Github/orcamento_ministerios/df_de_para.RDS")
dados_orcamento_2018_2023 <- readRDS("~/Github/orcamento_ministerios/dados_orcamento_2018_2023.rds")

```


```{r}

dados_orcamento_2023%>%
  mutate(empenhado_dotacao = (empenhado/dotacao_atual)*100) %>%
  mutate(nome_curto = reorder(nome_curto, empenhado_dotacao)) %>%
  ggplot(aes(x= empenhado_dotacao, y= nome_curto)) +
  geom_col()

```

```{r}
dados_orcamento_2023%>%
  mutate(pago_dotacao = (pago/dotacao_atual)*100) %>%
  mutate(nome_curto = reorder(nome_curto, pago_dotacao)) %>%
  ggplot(aes(x= pago_dotacao, y= nome_curto)) +
  geom_col()

```

```{r}
dados_orcamento_2023%>%
  mutate(pago_empenhado = (pago/empenhado)*100) %>%
  mutate(nome_curto = reorder(nome_curto, pago_empenhado)) %>%
  ggplot(aes(x= pago_empenhado, y= nome_curto)) +
  geom_col()

```

```{r}
dados_orcamento_2023%>%
  mutate(pago_empenhado = (pago/empenhado)*100)%>%
  mutate(categoria  = "Ministérios") %>%
  ggplot(aes(x=categoria, y=pago_empenhado)) +
  geom_boxplot(fill=NA, outlier.shape = NA) +
  geom_jitter() 

```

```{r}

pago_empenhado_ministerios<-
  dados_orcamento_2018_2023 %>%
  summarise(pago = sum(pago),
            empenhado = sum(empenhado),
            .by = c(ano,orgao_orcamentario)) %>%
  ungroup() %>%
  mutate(pago_empenhado = (pago/empenhado)*100) %>%
  group_by(ano) %>%
  slice_max(order_by = pago_empenhado, n=1 ) %>%
  select(ano, orgao_orcamentario)
  


dados_selecao<-
  dados_orcamento_2018_2023 %>%
  inner_join(pago_empenhado_ministerios, by= c("ano", "orgao_orcamentario")) %>%
  mutate(pago_empenhado = (pago/empenhado)*100) %>%
  inner_join(df_de_para)
  


dados_orcamento_2018_2023 %>%
  anti_join(dados_selecao) %>%
  mutate(pago_empenhado = (pago/empenhado)*100)%>%
  ggplot(aes(x=ano, y=pago_empenhado)) +
  geom_jitter(pch= 21, fill= "#DCDCDC",color="#B8B8B8") +  
  geom_boxplot(fill=NA,  outlier.shape = NA, color = "black", fatten = 1.5) +
  geom_jitter(data= dados_selecao, aes(fill= str_wrap(nome_curto,20), color = str_wrap(nome_curto,20)),  pch= 21, size =2 ) +
  scale_fill_discrete_divergingx(palette = "Zissou 1") +
  scale_color_discrete_divergingx(palette = "Zissou 1")+
  theme_light()+
  theme(
    panel.grid = element_blank(),
    panel.border = element_blank(),
    panel.background = element_rect(fill= "#B8B8B8")
  ) +
  labs(
    title = "Distribuição de pago/efetivo entre as Unidades Orçamentárias",
    subtitle = "Valores em (%)",
    fill = "Órgão central",
    color = "Órgão central",
    x = "",
    y = ""
  )

 


```

```{r}
pago_empenhado_ministerios<-
  dados_orcamento_2018_2023 %>%
  filter(ano==2023) %>%
  summarise(pago = sum(pago),
            empenhado = sum(empenhado),
            .by = c(ano,orgao_orcamentario)) %>%
  ungroup() %>%
  mutate(pago_empenhado = (pago/empenhado)*100) %>%
  group_by(ano) %>%
  slice_max(order_by = pago_empenhado, n=1 )
  

ministerios_mais_executores<- pago_empenhado_ministerios$orgao_orcamentario  
ministerios_selecao<- c(ministerios_mais_executores, "28000 - Ministério do Desenvolvimento, Indústria, Comércio e Serviços")

dados_selecao<-
  dados_orcamento_2018_2023 %>%
  filter(ano==2023) %>%
  mutate(pago_empenhado = (pago/empenhado)*100) %>%
  filter(orgao_orcamentario %in% ministerios_selecao) %>%
  inner_join(df_de_para)


dados_orcamento_2018_2023 %>%
  filter(ano == 2023) %>%
  anti_join(dados_selecao) %>%
  mutate(pago_empenhado = (pago/empenhado)*100)%>%
  ggplot(aes(x=ano, y=pago_empenhado)) +
  geom_jitter(pch= 21, fill= "#DCDCDC",color="#B8B8B8") +  
  geom_boxplot(fill=NA,  outlier.shape = NA,fatten = 1.5) +
  geom_jitter(data= dados_selecao, aes(fill= nome_curto, color = nome_curto), pch= 21, size =2 ) +
  scale_fill_discrete_divergingx(palette = "Roma") +
  scale_color_discrete_divergingx(palette = "Roma")+
  theme_light()+
  theme(
    panel.grid = element_blank(),
    panel.border = element_blank(),
    panel.background = element_rect(fill= "#B8B8B8")
  ) +
  labs(
    title = "Distribuição de pago/efetivo entre as Unidades Orçamentárias",
    subtitle = "Valores em (%)",
    fill = "Órgão central",
    color = "Órgão central",
    x = "",
    y = ""
  )

 
```

